import{a as B}from"./chunk-CBZG3F6H.js";import{a as A}from"./chunk-PYRLKSTA.js";import{a as N,b as R,c as y,d as O,e as $,g as I,j as P,k as G,l as q,m as D,n as w,o as V,p as K,r as j}from"./chunk-IUR5LZKD.js";import"./chunk-Y3SXRRHJ.js";import{$a as E,Gb as T,Ib as f,Na as n,Tb as c,Ub as u,Va as _,Vb as M,Xb as b,fc as k,nb as d,ob as m,pb as F,qb as h,rb as v,sb as p,tb as l,ub as a,vb as g}from"./chunk-2C2P2UZ5.js";var L=()=>[],H=(t,i)=>i.title;function J(t,i){t&1&&(l(0,"span",8),c(1,"*"),a())}function Q(t,i){t&1&&(l(0,"div",10),c(1,"This field is required."),a())}function U(t,i){if(t&1&&(g(0,"input",9),d(1,Q,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,s=f();p("placeholder",e.title)("formControlName",s.fieldKey(r)),n(),m(s.hasError(r,"required")?1:-1)}}function W(t,i){t&1&&(l(0,"div",10),c(1,"This field is required."),a())}function X(t,i){t&1&&(l(0,"div",10),c(1,"This is not a valid email."),a())}function Y(t,i){if(t&1&&(g(0,"input",11),d(1,W,2,0,"div",10),d(2,X,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,s=f();p("placeholder",e.title)("formControlName",s.fieldKey(r)),n(),m(s.hasError(r,"required")?1:-1),n(),m(s.hasError(r,"email")?2:-1)}}function Z(t,i){if(t&1&&(l(0,"option",14),c(1),a()),t&2){let o=i.$implicit;p("value",o),n(),u(o)}}function ee(t,i){t&1&&(l(0,"div",10),c(1,"This field is required."),a())}function te(t,i){if(t&1&&(l(0,"select",12)(1,"option",13),c(2,"Select"),a(),h(3,Z,2,2,"option",14,F),a(),d(5,ee,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,s=f();p("formControlName",s.fieldKey(r)),n(3),v(e.options??b(2,L)),n(2),m(s.hasError(r,"required")?5:-1)}}function ie(t,i){if(t&1&&(l(0,"label",16),g(1,"input",17),l(2,"span"),c(3),a()()),t&2){let o=i.$implicit,e=i.$index;n(),p("formControlName",e),n(2),u(o)}}function oe(t,i){t&1&&(l(0,"div",10),c(1,"Select at least one option."),a())}function re(t,i){if(t&1&&(l(0,"div",15),h(1,ie,4,2,"label",16,F),a(),d(3,oe,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,s=f();p("formArrayName",s.fieldKey(r)),n(),v(e.options??b(2,L)),n(2),m(s.hasError(r,"required")?3:-1)}}function ne(t,i){if(t&1&&(l(0,"div",1)(1,"div",7)(2,"h3",2),c(3),d(4,J,2,0,"span",8),a(),l(5,"div",3),c(6),a()(),d(7,U,2,3)(8,Y,3,4)(9,te,6,3)(10,re,4,3),a()),t&2){let o,e=i.$implicit;n(3),M(" ",e.title," "),n(),m(e.isRequired?4:-1),n(2),u(e.desc),n(),m((o=e.type)==="text"?7:o==="email"?8:o==="select"?9:o==="checkbox"?10:-1)}}function ae(t,i){t&1&&(l(0,"div",6),c(1,"Saved."),a())}var le=t=>t.controls.some(e=>e.value)?null:{required:!0},z=class t{constructor(i,o,e,r){this.fb=i;this.formService=o;this.cdr=e;this.ar=r;this.read(this.ar.snapshot.queryParamMap.get("id")??"")}sampleResponse={createdAt:"",updateAt:"",title:"",desc:"",link:"",fields:[]};formId="";formGroup;submitted=!1;read(i){this.formId=i,this.formService.getById(i).then(o=>{this.sampleResponse=o,this.formGroup=this.buildForm(this.sampleResponse),this.cdr.detectChanges()})}fields(){return this.sampleResponse.fields}fieldKey(i){return`f_${i}`}checkboxArray(i){return this.formGroup.get(this.fieldKey(i))}hasError(i,o){let e=this.formGroup.get(this.fieldKey(i));return!!e&&e.touched&&e.hasError(o)}submit(){if(this.submitted=!1,this.formGroup.markAllAsTouched(),this.formGroup.invalid)return;let i=new Map;i.set("formId",this.formId);for(let e=0;e<this.sampleResponse.fields.length;e++){let r=this.sampleResponse.fields[e],s=r.title;var o={};if(r.type==="checkbox"){let x=this.checkboxArray(e);i.set(s,(r.options??[]).filter((S,C)=>!!x.at(C)?.value))}else i.set(s,String(this.formGroup.get(this.fieldKey(e))?.value??""))}console.log(Object.fromEntries(i.entries())),this.submitted=!0,this.formGroup.reset(this.buildForm(this.sampleResponse).getRawValue())}buildForm(i){let o={};return i.fields.forEach((e,r)=>{let s=this.fieldKey(r);if(e.type==="checkbox"){let S=e.options??[],C=this.fb.array(S.map(()=>this.fb.control(!1,{nonNullable:!0})));e.isRequired&&C.addValidators(le),o[s]=C;return}let x=e.isRequired?[y.required]:[];e.type==="email"&&x.push(y.email),o[s]=this.fb.control("",{nonNullable:!0,validators:x})}),this.fb.group(o)}static \u0275fac=function(o){return new(o||t)(_(K),_(B),_(k),_(A))};static \u0275cmp=E({type:t,selectors:[["app-form"]],decls:12,vars:5,consts:[[1,"card","content",3,"ngSubmit","formGroup"],[1,"card"],[1,"title"],[1,"muted"],[1,"card","actions"],["type","submit",1,"btn",3,"disabled"],[1,"ok"],[1,"head"],[1,"req"],["type","text",1,"plain",3,"placeholder","formControlName"],[1,"err"],["type","email",1,"plain",3,"placeholder","formControlName"],[1,"plain",3,"formControlName"],["value","","disabled","","selected",""],[3,"value"],[1,"stack",3,"formArrayName"],[1,"opt"],["type","checkbox",3,"formControlName"]],template:function(o,e){o&1&&(l(0,"form",0),T("ngSubmit",function(){return e.submit()}),l(1,"div",1)(2,"h2",2),c(3),a(),l(4,"p",3),c(5),a()(),h(6,ne,11,4,"div",1,H),l(8,"div",4)(9,"button",5),c(10,"Submit"),a(),d(11,ae,2,0,"div",6),a()()),o&2&&(p("formGroup",e.formGroup),n(3),u(e.sampleResponse.title),n(2),u(e.sampleResponse.desc),n(),v(e.fields()),n(3),p("disabled",e.formGroup.invalid),n(2),m(e.submitted?11:-1))},dependencies:[j,I,w,V,R,N,D,O,$,q,G,P],styles:[".content[_ngcontent-%COMP%]{display:grid;gap:12px;max-width:820px;margin:0 auto;padding:14px}.card[_ngcontent-%COMP%]{margin:10px auto;width:100%}.title[_ngcontent-%COMP%]{margin:0;font-weight:900}.muted[_ngcontent-%COMP%]{color:#bdbdbd;font-size:13px;margin-top:6px}.stack[_ngcontent-%COMP%]{display:grid;gap:10px;margin-top:10px}.opt[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:start}.opt[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:16px;height:16px}.head[_ngcontent-%COMP%]{display:grid;gap:6px;margin-bottom:10px}.qtitle[_ngcontent-%COMP%]{margin:0;font-weight:900}.req[_ngcontent-%COMP%]{opacity:.9;margin-left:6px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.btn[_ngcontent-%COMP%]{border:1px solid #2b2b2b;background:#141414;color:#fff;padding:10px 14px;border-radius:12px;font-weight:900;cursor:pointer}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.err[_ngcontent-%COMP%]{margin-top:8px;font-size:12px;color:#8b0000;opacity:.9}.ok[_ngcontent-%COMP%]{font-size:12px;color:#bdbdbd}"]})};export{z as Form};
