import{a as B}from"./chunk-PVMSEXX3.js";import{a as z}from"./chunk-O5EWAHD6.js";import{a as k}from"./chunk-JEIDM252.js";import{a as A,b as N,c as y,d as O,e as I,g as $,j as P,k as G,l as q,m as D,n as w,o as V,p as K,r as j}from"./chunk-IUR5LZKD.js";import"./chunk-Y3SXRRHJ.js";import{$a as E,Gb as R,Ib as f,Na as n,Tb as s,Ub as _,Va as u,Vb as T,Xb as b,fc as M,nb as d,ob as m,pb as F,qb as C,rb as h,sb as p,tb as c,ub as a,vb as g}from"./chunk-2C2P2UZ5.js";var H=()=>[],J=(t,i)=>i.title;function Q(t,i){t&1&&(c(0,"span",8),s(1,"*"),a())}function U(t,i){t&1&&(c(0,"div",10),s(1,"This field is required."),a())}function W(t,i){if(t&1&&(g(0,"input",9),d(1,U,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,l=f();p("placeholder",e.title)("formControlName",l.fieldKey(r)),n(),m(l.hasError(r,"required")?1:-1)}}function X(t,i){t&1&&(c(0,"div",10),s(1,"This field is required."),a())}function Y(t,i){t&1&&(c(0,"div",10),s(1,"This is not a valid email."),a())}function Z(t,i){if(t&1&&(g(0,"input",11),d(1,X,2,0,"div",10),d(2,Y,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,l=f();p("placeholder",e.title)("formControlName",l.fieldKey(r)),n(),m(l.hasError(r,"required")?1:-1),n(),m(l.hasError(r,"email")?2:-1)}}function ee(t,i){if(t&1&&(c(0,"option",14),s(1),a()),t&2){let o=i.$implicit;p("value",o),n(),_(o)}}function te(t,i){t&1&&(c(0,"div",10),s(1,"This field is required."),a())}function ie(t,i){if(t&1&&(c(0,"select",12)(1,"option",13),s(2,"Select"),a(),C(3,ee,2,2,"option",14,F),a(),d(5,te,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,l=f();p("formControlName",l.fieldKey(r)),n(3),h(e.options??b(2,H)),n(2),m(l.hasError(r,"required")?5:-1)}}function oe(t,i){if(t&1&&(c(0,"label",16),g(1,"input",17),c(2,"span"),s(3),a()()),t&2){let o=i.$implicit,e=i.$index;n(),p("formControlName",e),n(2),_(o)}}function re(t,i){t&1&&(c(0,"div",10),s(1,"Select at least one option."),a())}function ne(t,i){if(t&1&&(c(0,"div",15),C(1,oe,4,2,"label",16,F),a(),d(3,re,2,0,"div",10)),t&2){let o=f(),e=o.$implicit,r=o.$index,l=f();p("formArrayName",l.fieldKey(r)),n(),h(e.options??b(2,H)),n(2),m(l.hasError(r,"required")?3:-1)}}function ae(t,i){if(t&1&&(c(0,"div",1)(1,"div",7)(2,"h3",2),s(3),d(4,Q,2,0,"span",8),a(),c(5,"div",3),s(6),a()(),d(7,W,2,3)(8,Z,3,4)(9,ie,6,3)(10,ne,4,3),a()),t&2){let o,e=i.$implicit;n(3),T(" ",e.title," "),n(),m(e.isRequired?4:-1),n(2),_(e.desc),n(),m((o=e.type)==="text"?7:o==="email"?8:o==="select"?9:o==="checkbox"?10:-1)}}function le(t,i){t&1&&(c(0,"div",6),s(1,"Saved."),a())}var ce=t=>t.controls.some(e=>e.value)?null:{required:!0},L=class t{constructor(i,o,e,r,l){this.fb=i;this.formService=o;this.recordService=e;this.cdr=r;this.ar=l;this.read(this.ar.snapshot.queryParamMap.get("id")??"")}sampleResponse={createdAt:"",updateAt:"",title:"",desc:"",link:"",fields:[]};formId="";formGroup;submitted=!1;read(i){this.formId=i,this.formService.getById(i).then(o=>{this.sampleResponse=o,this.formGroup=this.buildForm(this.sampleResponse),this.cdr.detectChanges()})}fields(){return this.sampleResponse.fields}fieldKey(i){return`f_${i}`}checkboxArray(i){return this.formGroup.get(this.fieldKey(i))}hasError(i,o){let e=this.formGroup.get(this.fieldKey(i));return!!e&&e.touched&&e.hasError(o)}submit(){if(this.submitted=!1,this.formGroup.markAllAsTouched(),this.formGroup.invalid)return;let i=new Map;i.set("formId",this.formId);for(let e=0;e<this.sampleResponse.fields.length;e++){let r=this.sampleResponse.fields[e],l=r.title;var o={};if(r.type==="checkbox"){let x=this.checkboxArray(e);i.set(l,(r.options??[]).filter((S,v)=>!!x.at(v)?.value))}else i.set(l,String(this.formGroup.get(this.fieldKey(e))?.value??""))}this.recordService.create(Object.fromEntries(i.entries())),this.submitted=!0,this.formGroup.reset(this.buildForm(this.sampleResponse).getRawValue())}buildForm(i){let o={};return i.fields.forEach((e,r)=>{let l=this.fieldKey(r);if(e.type==="checkbox"){let S=e.options??[],v=this.fb.array(S.map(()=>this.fb.control(!1,{nonNullable:!0})));e.isRequired&&v.addValidators(ce),o[l]=v;return}let x=e.isRequired?[y.required]:[];e.type==="email"&&x.push(y.email),o[l]=this.fb.control("",{nonNullable:!0,validators:x})}),this.fb.group(o)}static \u0275fac=function(o){return new(o||t)(u(K),u(B),u(z),u(M),u(k))};static \u0275cmp=E({type:t,selectors:[["app-form"]],decls:12,vars:5,consts:[[1,"card","content",3,"ngSubmit","formGroup"],[1,"card"],[1,"title"],[1,"muted"],[1,"card","actions"],["type","submit",1,"btn",3,"disabled"],[1,"ok"],[1,"head"],[1,"req"],["type","text",1,"plain",3,"placeholder","formControlName"],[1,"err"],["type","email",1,"plain",3,"placeholder","formControlName"],[1,"plain",3,"formControlName"],["value","","disabled","","selected",""],[3,"value"],[1,"stack",3,"formArrayName"],[1,"opt"],["type","checkbox",3,"formControlName"]],template:function(o,e){o&1&&(c(0,"form",0),R("ngSubmit",function(){return e.submit()}),c(1,"div",1)(2,"h2",2),s(3),a(),c(4,"p",3),s(5),a()(),C(6,ae,11,4,"div",1,J),c(8,"div",4)(9,"button",5),s(10,"Submit"),a(),d(11,le,2,0,"div",6),a()()),o&2&&(p("formGroup",e.formGroup),n(3),_(e.sampleResponse.title),n(2),_(e.sampleResponse.desc),n(),h(e.fields()),n(3),p("disabled",e.formGroup.invalid),n(2),m(e.submitted?11:-1))},dependencies:[j,$,w,V,N,A,D,O,I,q,G,P],styles:[".content[_ngcontent-%COMP%]{display:grid;gap:12px;max-width:820px;margin:0 auto;padding:14px}.card[_ngcontent-%COMP%]{margin:10px auto;width:100%}.title[_ngcontent-%COMP%]{margin:0;font-weight:900}.muted[_ngcontent-%COMP%]{color:#bdbdbd;font-size:13px;margin-top:6px}.stack[_ngcontent-%COMP%]{display:grid;gap:10px;margin-top:10px}.opt[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:start}.opt[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:16px;height:16px}.head[_ngcontent-%COMP%]{display:grid;gap:6px;margin-bottom:10px}.qtitle[_ngcontent-%COMP%]{margin:0;font-weight:900}.req[_ngcontent-%COMP%]{opacity:.9;margin-left:6px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.btn[_ngcontent-%COMP%]{border:1px solid #2b2b2b;background:#141414;color:#fff;padding:10px 14px;border-radius:12px;font-weight:900;cursor:pointer}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.err[_ngcontent-%COMP%]{margin-top:8px;font-size:12px;color:#8b0000;opacity:.9}.ok[_ngcontent-%COMP%]{font-size:12px;color:#bdbdbd}"]})};export{L as Form};
